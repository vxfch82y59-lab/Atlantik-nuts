/* Minimal, saÄŸlam ve telifsiz JS
   - Hamburger menu
      - Hero slider (auto)
         - Section switch + lazy load images (data-src)
            - Circular images fade-in
            */

            (function(){
              'use strict';

                // helpers
                  const $ = (s, ctx=document) => ctx.querySelector(s);
                    const $$ = (s, ctx=document) => Array.from(ctx.querySelectorAll(s));

                      // elements
                        const hambtn = $('#hambtn');
                          const mainnav = $('#mainnav');
                            const navlinks = $$('.nav-link');
                              const pages = $$('.page');
                                const yearEl = $('#year');

                                  // initial
                                    if(yearEl) yearEl.textContent = new Date().getFullYear();

                                      // hamburger toggle
                                        hambtn && hambtn.addEventListener('click', ()=>{
                                            const open = mainnav.classList.toggle('open');
                                                hambtn.setAttribute('aria-expanded', open ? 'true' : 'false');
                                                    mainnav.setAttribute('aria-hidden', open ? 'false' : 'true');
                                                      });

                                                        // hero slider
                                                          (function heroSlider(){
                                                              const slides = $$('.hero-slide');
                                                                  if(!slides.length) return;
                                                                      let idx = 0;
                                                                          function show(i){
                                                                                slides.forEach((s,si)=> s.classList.toggle('active', si===i));
                                                                                    }
                                                                                        show(0);
                                                                                            setInterval(()=> {
                                                                                                  idx = (idx+1) % slides.length;
                                                                                                        show(idx);
                                                                                                            }, 5000);
                                                                                                              })();

                                                                                                                // Lazy loader for elements with data-src inside a container
                                                                                                                  function loadImagesIn(container){
                                                                                                                      if(!container) return;
                                                                                                                          const imgs = container.querySelectorAll('[data-src]');
                                                                                                                              imgs.forEach(el=>{
                                                                                                                                    const src = el.getAttribute('data-src');
                                                                                                                                          if(!src) return;
                                                                                                                                                // create image and set as background for .circle or img tag
                                                                                                                                                      const img = new Image();
                                                                                                                                                            img.onload = () => {
                                                                                                                                                                    // if element is a div (circle), set background
                                                                                                                                                                            if(el.classList.contains('circle') || el.classList.contains('prod-img')){
                                                                                                                                                                                      el.style.backgroundImage = `url('${src}')`;
                                                                                                                                                                                                el.classList.add('loaded');
                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                  // fallback: set src
                                                                                                                                                                                                                            el.src = src;
                                                                                                                                                                                                                                      el.classList.add('loaded');
                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                          img.src = src;
                                                                                                                                                                                                                                                                el.removeAttribute('data-src');
                                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                        // Switch sections (single-page style)
                                                                                                                                                                                                                                                                          function activateSection(id){
                                                                                                                                                                                                                                                                              pages.forEach(p => {
                                                                                                                                                                                                                                                                                    if(p.id === id){
                                                                                                                                                                                                                                                                                            p.classList.remove('hidden');
                                                                                                                                                                                                                                                                                                    p.classList.add('fade-in');
                                                                                                                                                                                                                                                                                                          } else {
                                                                                                                                                                                                                                                                                                                  p.classList.add('hidden');
                                                                                                                                                                                                                                                                                                                          p.classList.remove('fade-in');
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                    });

                                                                                                                                                                                                                                                                                                                                        // close mobile menu if open
                                                                                                                                                                                                                                                                                                                                            if(mainnav.classList.contains('open')){
                                                                                                                                                                                                                                                                                                                                                  mainnav.classList.remove('open');
                                                                                                                                                                                                                                                                                                                                                        hambtn.setAttribute('aria-expanded','false');
                                                                                                                                                                                                                                                                                                                                                              mainnav.setAttribute('aria-hidden','true');
                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                      // lazy-load images in this section
                                                                                                                                                                                                                                                                                                                                                                          const sec = document.getElementById(id);
                                                                                                                                                                                                                                                                                                                                                                              if(sec){
                                                                                                                                                                                                                                                                                                                                                                                    // first try for data-images attribute
                                                                                                                                                                                                                                                                                                                                                                                          if(sec.querySelectorAll('[data-src]').length) loadImagesIn(sec);
                                                                                                                                                                                                                                                                                                                                                                                                // also handle containers marked data-images="lazy"
                                                                                                                                                                                                                                                                                                                                                                                                      const lazyContainers = sec.querySelectorAll('[data-images="lazy"]');
                                                                                                                                                                                                                                                                                                                                                                                                            lazyContainers.forEach(c => loadImagesIn(c));
                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                    // update active nav link
                                                                                                                                                                                                                                                                                                                                                                                                                        navlinks.forEach(n => n.classList.toggle('active', n.getAttribute('data-target')===id));
                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                            // init navlinks
                                                                                                                                                                                                                                                                                                                                                                                                                              navlinks.forEach(a=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                  a.addEventListener('click', (e)=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                        const t = a.getAttribute('data-target');
                                                                                                                                                                                                                                                                                                                                                                                                                                              if(!t) return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                    activateSection(t);
                                                                                                                                                                                                                                                                                                                                                                                                                                                          // scroll to top
                                                                                                                                                                                                                                                                                                                                                                                                                                                                window.scrollTo({top:0, behavior:'smooth'});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // buttons that target sections (hero ctas)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          $$('.btn[data-target]').forEach(b => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.addEventListener('click',(e)=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const t = b.getAttribute('data-target');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if(t) activateSection(t);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // initial: show home
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    activateSection('home');

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // intersection for circles fade-in when they enter viewport
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const observer = new IntersectionObserver((entries, obs) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            entries.forEach(ent => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if(ent.isIntersecting){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const el = ent.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  el.classList.remove('fade');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          el.classList.add('loaded');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  obs.unobserve(el);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }, {threshold:0.12});

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // observe existing circles (placeholders)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  $$('.circle').forEach(c => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      c.classList.add('fade');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          observer.observe(c);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            })();